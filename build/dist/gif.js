!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(self,(()=>{return t={764:t=>{t.exports=class{constructor(){this.pending=0,this.closed=!1,this.inErrorState=!1,this.error=null}wait(){return this.inErrorState?Promise.reject(this.error):this.closed?Promise.resolve(void 0):new Promise(((t,e)=>{this.pending.push({resolve:t,reject:e})}))}notifyOne(){this.pending.length>0&&this.pending.shift()?.resolve()}notifyAll(){this.pending.forEach((t=>t.resolve())),this.pending=[]}rejectAll(t){this.inErrorState=!0,this.error=t,this.pending.forEach((e=>e.reject(t))),this.pending=[]}close(){this.notifyAll(),this.closed=!0}}},503:(t,e,i)=>{const s=i(373),r={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1},a={delay:500,copy:!1,applyCropOptimization:!1,transparencyDifferenceThreshold:1,applyTransparencyOptimization:!1,dispose:-1,isLastFrame:!1};t.exports=class{constructor(t){this.freeWorkers=[],this.activeWorkers=[],this.gifConfig={...r,...t},console.log(this.gifConfig),this.queueSize=Math.max(this.gifConfig.workers,1),this.spawnWorkers(),this.frames=[],this.previousFrames=[],this.groups=new Map,this.throttler=new s(this.gifConfig.workers),this.nextFrame=0,this.imageParts=[]}spawnWorkers(){for(let t=0;t<this.gifConfig.workers;t++){const t=new Worker(this.gifConfig.workerScript);t.onmessage=e=>{this.activeWorkers.splice(this.activeWorkers.indexOf(t)),this.freeWorkers.push(t),this.frameFinished(e.data,!1)},this.freeWorkers.push(t)}}async addFrame(t,e){let i={...a,...e},s={};i.transparent=this.gifConfig.transparent,await new Promise((t=>setTimeout(t,100))),this.gifConfig.width||(this.gifConfig.width=t.width),this.gifConfig.height||(this.gifConfig.height=t.height),i=this.getFrameData(t,i,e),this.gifConfig.applyTransparencyOptimization&&e.previousImage&&(s=this.getFrameData(e.previousImage,s,e)),console.log("HERE");let r=this.frames.length;r>0&&i.data&&(this.groups.has(i.data)?this.groups.get(i.data).push(r):this.groups.set(i.data,r)),this.frames.push(i),s.data&&this.previousFrames.push(s),await this.throttler.wait(),this.render()}render(t=!1){if(this.nextFrame>this.frames.length)return;if(!this.gifConfig.width||!this.gifConfig.height)throw new Error("Width and height must be set prior to rendering");if(0===this.freeWorkers.length)throw new Error("No workers available");let e=this.nextFrame,i=this.frames[e];this.imageParts.push(null);let s=null;if(this.previousFrames.length>e-1&&(s=this.previousFrames[e-1]),this.nextFrame++,e>0&&this.groups.has(i.data)&&this.groups.get(i.data)[0]!=e)return this.frameFinished(i,!0);const r=this.freeWorkers.shift(),a=this.getTask(e,i,s,t);this.activeWorkers.push(r),r.postMessage(a)}abort(){for(let t=0;t<this.activeWorkers.length;t++)this.activeWorkers[t].terminate()}getTask(t,e,i,s){return{index:t,last:s,delay:e.delay,transparent:e.transparent,width:this.gifConfig.width,height:this.gifConfig.height,quality:this.gifConfig.quality,dither:this.gifConfig.dither,globalPalette:this.gifConfig.globalPalette,repeat:this.gifConfig.repeat,canTransfer:!0,data:this.getFrameDataForTask(e),applyCropOptimization:this.gifConfig.applyCropOptimization,transparencyDifferenceThreshold:this.gifConfig.transparencyDifferenceThreshold,dispose:this.gifConfig.dispose,applyTransparencyOptimization:this.gifConfig.applyTransparencyOptimization,previousFrameData:i?this.getFrameDataForTask(i):null}}getContextData(t){return t.getImageData(0,0,this.gifConfig.width,this.gifConfig.height).data}getFrameDataForTask(t){if(t.data)return t.data;if(t.context)return this.getContextData(t.context);if(t.image)return this.getImageData(t.image);throw new Error("Invalid frame")}frameFinished(t,e){if(e){let e=this.groups.get(t.data)[0];this.imageParts[t.index]={indexOfFirstInGroup:e}}else this.imageParts[t.index]=t;!0!==this.gifConfig.options||e||(this.gifConfig.globalPalette=t.globalPalette),this.throttler.notify()}async flush(){for(var t in await this.throttler.wait(),this.imageParts)(a=this.imageParts[t]).indexOfFirstInGroup&&(this.imageParts[t]=this.imageParts[a.indexOfFirstInGroup]);var e=0;for(var i in this.imageParts)e+=((a=this.imageParts[i]).data.length-1)*a.pageSize+a.cursor;e+=a.pageSize-a.cursor;var s=new Uint8Array(e),r=0;for(var i in this.imageParts){var a=this.imageParts[i];for(var n in a.data){var o=a.data[n];s.set(o,r),n==a.data.length-1?r+=a.cursor:r+=a.pageSize}}return new Blob([s],{type:"image/gif"})}getFrameData(t,e,i={}){if("undefined"!=typeof ImageData&&t instanceof ImageData)e.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext)i.copy?e.data=this.getContextData(t):e.context=t;else{if(!t.childNodes)throw new Error("Invalid image");i.copy?e.data=this.getImageData(t):e.image=t}return e}getImageData(t){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.gifConfig.width,this._canvas.height=this.gifConfig.height);var e=this._canvas.getContext("2d");return e.setFill=this.gifConfig.background,e.fillRect(0,0,this.gifConfig.width,this.gifConfig.height),e.drawImage(t,0,0),this.getContextData(e)}}},373:(t,e,i)=>{var s=i(764);t.exports=class{constructor(t){this.maxPending=t,this.pendingCount=0,this.full=new s}async wait(){for(;this.pendingCount>=this.maxPending;)await this.full.wait();this.pendingCount++}notify(){this.pendingCount--,this.full.notifyOne()}}}},e={},function i(s){var r=e[s];if(void 0!==r)return r.exports;var a=e[s]={exports:{}};return t[s](a,a.exports,i),a.exports}(503);var t,e}));
//# sourceMappingURL=gif.js.map