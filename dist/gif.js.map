{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///gif.js","webpack:///webpack/bootstrap 1c35d463df0a05b881a0","webpack:///./src/gif.coffee","webpack:///./~/events/events.js","webpack:///./src/browser.coffee"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","EventEmitter","GIF","browser","extend","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","indexOf","item","i","l","length","superClass","options","base","value","running","frames","previousFrames","Map","pendingFrameCount","groups","freeWorkers","activeWorkers","canFinish","setOptions","defaults","batchSizeForRendering","workers","curBatchSizeLastIndex","spawnWorkers","taskQueue","frameDefaults","workerScript","repeat","background","quality","width","height","transparent","debug","delay","copy","applyCropOptimization","transparencyDifferenceThreshold","applyTransparencyOptimization","dispose","setOption","_canvas","results","push","getFrameData","image","frame","ImageData","data","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","context","childNodes","Error","getImageData","addFrame","index","previousFrame","previousImage","has","get","set","flushTasks","then","addBatchForRendering","emit","render","j","k","numWorkers","ref","ref1","nextFrame","finishedFrames","Math","min","imageParts","globalPalette","renderNextFrame","abort","worker","shift","log","terminate","framesToRender","task","Promise","resolve","setTimeout","all","error","apply","forEach","_this","Worker","onmessage","event","splice","frameFinished","duplicate","indexOfDuplicate","indexOfFirstInGroup","finishRendering","flush","len","len1","len2","len3","len4","offset","page","ref2","ref3","pageSize","cursor","round","Uint8Array","Blob","type","getTask","postMessage","ctx","document","createElement","getContext","setFill","fillRect","drawImage","getFrameDataForTask","last","dither","canTransfer","previousFrameData","msg","console","_events","_maxListeners","undefined","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","er","handler","args","listeners","arguments","err","Array","slice","addListener","listener","newListener","warned","trace","on","once","g","removeListener","fired","list","position","removeAllListeners","ret","listenerCount","evlistener","emitter","UA","mode","platform","ua","navigator","userAgent","toLowerCase","match","documentMode","name","version","parseFloat","parseInt"],"mappings":"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","file":"gif.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GIF\"] = factory();\n\telse\n\t\troot[\"GIF\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GIF\"] = factory();\n\telse\n\t\troot[\"GIF\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar EventEmitter, GIF, browser,\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty,\n\t  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\t\n\tEventEmitter = __webpack_require__(1).EventEmitter;\n\t\n\tbrowser = __webpack_require__(2);\n\t\n\tGIF = (function(superClass) {\n\t  var defaults, frameDefaults;\n\t\n\t  extend(GIF, superClass);\n\t\n\t  defaults = {\n\t    workerScript: 'gif.worker.js',\n\t    workers: 2,\n\t    repeat: 0,\n\t    background: '#fff',\n\t    quality: 10,\n\t    width: null,\n\t    height: null,\n\t    transparent: null,\n\t    debug: false\n\t  };\n\t\n\t  frameDefaults = {\n\t    delay: 500,\n\t    copy: false,\n\t    applyCropOptimization: false,\n\t    transparencyDifferenceThreshold: 1,\n\t    applyTransparencyOptimization: false,\n\t    dispose: -1\n\t  };\n\t\n\t  function GIF(options) {\n\t    var base, key, value;\n\t    this.running = false;\n\t    this.options = {};\n\t    this.frames = [];\n\t    this.previousFrames = new Map();\n\t    this.pendingFrameCount = 0;\n\t    this.groups = new Map();\n\t    this.freeWorkers = [];\n\t    this.activeWorkers = [];\n\t    this.canFinish = false;\n\t    this.setOptions(options);\n\t    for (key in defaults) {\n\t      value = defaults[key];\n\t      if ((base = this.options)[key] == null) {\n\t        base[key] = value;\n\t      }\n\t    }\n\t    this.batchSizeForRendering = this.options.workers;\n\t    this.curBatchSizeLastIndex = 0;\n\t    this.spawnWorkers();\n\t    this.taskQueue = [];\n\t  }\n\t\n\t  GIF.prototype.setOption = function(key, value) {\n\t    this.options[key] = value;\n\t    if ((this._canvas != null) && (key === 'width' || key === 'height')) {\n\t      return this._canvas[key] = value;\n\t    }\n\t  };\n\t\n\t  GIF.prototype.setOptions = function(options) {\n\t    var key, results, value;\n\t    results = [];\n\t    for (key in options) {\n\t      if (!hasProp.call(options, key)) continue;\n\t      value = options[key];\n\t      results.push(this.setOption(key, value));\n\t    }\n\t    return results;\n\t  };\n\t\n\t  GIF.prototype.getFrameData = function(image, frame, options) {\n\t    if (options == null) {\n\t      options = {};\n\t    }\n\t    if ((typeof ImageData !== \"undefined\" && ImageData !== null) && image instanceof ImageData) {\n\t      frame.data = image.data;\n\t    } else if (((typeof CanvasRenderingContext2D !== \"undefined\" && CanvasRenderingContext2D !== null) && image instanceof CanvasRenderingContext2D) || ((typeof WebGLRenderingContext !== \"undefined\" && WebGLRenderingContext !== null) && image instanceof WebGLRenderingContext)) {\n\t      if (options.copy) {\n\t        frame.data = this.getContextData(image);\n\t      } else {\n\t        frame.context = image;\n\t      }\n\t    } else if (image.childNodes != null) {\n\t      if (options.copy) {\n\t        frame.data = this.getImageData(image);\n\t      } else {\n\t        frame.image = image;\n\t      }\n\t    } else {\n\t      throw new Error('Invalid image');\n\t    }\n\t    return frame;\n\t  };\n\t\n\t  GIF.prototype.addFrame = function(image, options) {\n\t    var frame, index, key, previousFrame;\n\t    if (options == null) {\n\t      options = {};\n\t    }\n\t    this.pendingFrameCount++;\n\t    frame = {};\n\t    previousFrame = {};\n\t    frame.transparent = this.options.transparent;\n\t    for (key in frameDefaults) {\n\t      frame[key] = options[key] || frameDefaults[key];\n\t    }\n\t    if (this.options.width == null) {\n\t      this.setOption('width', image.width);\n\t    }\n\t    if (this.options.height == null) {\n\t      this.setOption('height', image.height);\n\t    }\n\t    frame = this.getFrameData(image, frame, options);\n\t    if (this.options.applyTransparencyOptimization && (options.previousImage != null)) {\n\t      previousFrame = this.getFrameData(options.previousImage, previousFrame, options);\n\t    }\n\t    index = this.frames.length;\n\t    if (index > 0 && frame.data) {\n\t      if (this.groups.has(frame.data)) {\n\t        this.groups.get(frame.data).push(index);\n\t      } else {\n\t        this.groups.set(frame.data, [index]);\n\t      }\n\t    }\n\t    this.frames.push(frame);\n\t    if (previousFrame.data != null) {\n\t      this.previousFrames.set(index, previousFrame);\n\t    }\n\t    if (this.pendingFrameCount > this.batchSizeForRendering) {\n\t      if (this.freeWorkers.length === 0 || this.taskQueue.length > 0) {\n\t        this.flushTasks().then(function() {\n\t          return this.addBatchForRendering();\n\t        });\n\t      } else {\n\t        this.addBatchForRendering();\n\t      }\n\t    }\n\t    return this.emit('progress', 1);\n\t  };\n\t\n\t  GIF.prototype.render = function() {\n\t    var i, j, k, numWorkers, ref, ref1;\n\t    if (this.pendingFrameCount === 0) {\n\t      return;\n\t    }\n\t    if (this.running) {\n\t      throw new Error('Already running');\n\t    }\n\t    if ((this.options.width == null) || (this.options.height == null)) {\n\t      throw new Error('Width and height must be set prior to rendering');\n\t    }\n\t    this.running = true;\n\t    this.nextFrame = 0;\n\t    this.finishedFrames = 0;\n\t    for (i = j = 0, ref = Math.min(this.pendingFrameCount, this.batchSizeForRendering); 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {\n\t      this.imageParts.push(null);\n\t    }\n\t    numWorkers = this.freeWorkers.length;\n\t    if (this.options.globalPalette === true) {\n\t      this.renderNextFrame();\n\t    } else {\n\t      for (i = k = 0, ref1 = numWorkers; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {\n\t        this.renderNextFrame();\n\t      }\n\t    }\n\t    this.emit('start');\n\t    return this.emit('progress', 0);\n\t  };\n\t\n\t  GIF.prototype.abort = function() {\n\t    var worker;\n\t    while (true) {\n\t      worker = this.activeWorkers.shift();\n\t      if (worker == null) {\n\t        break;\n\t      }\n\t      this.log(\"killing active worker\");\n\t      worker.terminate();\n\t    }\n\t    this.running = false;\n\t    return this.emit('abort');\n\t  };\n\t\n\t  GIF.prototype.addBatchForRendering = function() {\n\t    var framesToRender, task;\n\t    framesToRender = Math.min(pendingFrameCount, this.batchSizeForRendering);\n\t    this.curBatchSizeLastIndex = this.curBatchSizeLastIndex + framesToRender;\n\t    task = new Promise(function(resolve) {\n\t      return setTimeout(function() {\n\t        this.render();\n\t        this.taskQueue = [];\n\t        return this.resolve();\n\t      });\n\t    });\n\t    return this.taskQueue.push(task);\n\t  };\n\t\n\t  GIF.prototype.flushTasks = function() {\n\t    return Promise.all(this.taskQueue).then(function() {\n\t      this.taskQueue = [];\n\t      return this.emit('progress', 2);\n\t    })[\"catch\"](function(error) {\n\t      throw error;\n\t    });\n\t  };\n\t\n\t  GIF.prototype.spawnWorkers = function() {\n\t    var j, numWorkers, ref, results;\n\t    numWorkers = Math.min(this.options.workers, this.frames.length);\n\t    (function() {\n\t      results = [];\n\t      for (var j = ref = this.freeWorkers.length; ref <= numWorkers ? j < numWorkers : j > numWorkers; ref <= numWorkers ? j++ : j--){ results.push(j); }\n\t      return results;\n\t    }).apply(this).forEach((function(_this) {\n\t      return function(i) {\n\t        var worker;\n\t        _this.log(\"spawning worker \" + i);\n\t        worker = new Worker(_this.options.workerScript);\n\t        worker.onmessage = function(event) {\n\t          _this.activeWorkers.splice(_this.activeWorkers.indexOf(worker), 1);\n\t          _this.freeWorkers.push(worker);\n\t          return _this.frameFinished(event.data, false);\n\t        };\n\t        return _this.freeWorkers.push(worker);\n\t      };\n\t    })(this));\n\t    return numWorkers;\n\t  };\n\t\n\t  GIF.prototype.frameFinished = function(frame, duplicate) {\n\t    var i, indexOfDuplicate, indexOfFirstInGroup, j, ref;\n\t    this.finishedFrames++;\n\t    this.pendingFrameCount--;\n\t    if (!duplicate) {\n\t      this.log(\"frame \" + (frame.index + 1) + \" finished - \" + this.activeWorkers.length + \" active\");\n\t      this.emit('progress', 1);\n\t      this.imageParts[frame.index] = frame;\n\t    } else {\n\t      indexOfDuplicate = this.frames.indexOf(frame);\n\t      indexOfFirstInGroup = this.groups.get(frame.data)[0];\n\t      this.log(\"frame \" + (indexOfDuplicate + 1) + \" is duplicate of \" + indexOfFirstInGroup + \" - \" + this.activeWorkers.length + \" active\");\n\t      this.imageParts[indexOfDuplicate] = {\n\t        indexOfFirstInGroup: indexOfFirstInGroup\n\t      };\n\t    }\n\t    if (this.options.globalPalette === true && !duplicate) {\n\t      this.options.globalPalette = frame.globalPalette;\n\t      this.log(\"global palette analyzed\");\n\t      if (this.frames.length > 2) {\n\t        for (i = j = 1, ref = this.freeWorkers.length; 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {\n\t          this.renderNextFrame();\n\t        }\n\t      }\n\t    }\n\t    if (indexOf.call(this.imageParts, null) >= 0) {\n\t      return this.renderNextFrame();\n\t    } else if (this.canFinish) {\n\t      return this.finishRendering();\n\t    }\n\t  };\n\t\n\t  GIF.prototype.flush = function() {\n\t    return this.flushTasks().then(function() {\n\t      this.canFinish = true;\n\t      return this.addBatchForRendering();\n\t    });\n\t  };\n\t\n\t  GIF.prototype.finishRendering = function() {\n\t    var data, frame, i, image, index, j, k, l, len, len1, len2, len3, len4, m, offset, page, ref, ref1, ref2, ref3;\n\t    ref = this.imageParts;\n\t    for (index = j = 0, len1 = ref.length; j < len1; index = ++j) {\n\t      frame = ref[index];\n\t      if (frame.indexOfFirstInGroup) {\n\t        this.imageParts[index] = this.imageParts[frame.indexOfFirstInGroup];\n\t      }\n\t    }\n\t    len = 0;\n\t    ref1 = this.imageParts;\n\t    for (k = 0, len2 = ref1.length; k < len2; k++) {\n\t      frame = ref1[k];\n\t      len += (frame.data.length - 1) * frame.pageSize + frame.cursor;\n\t    }\n\t    len += frame.pageSize - frame.cursor;\n\t    this.log(\"rendering finished - filesize \" + (Math.round(len / 1000)) + \"kb\");\n\t    data = new Uint8Array(len);\n\t    offset = 0;\n\t    ref2 = this.imageParts;\n\t    for (l = 0, len3 = ref2.length; l < len3; l++) {\n\t      frame = ref2[l];\n\t      ref3 = frame.data;\n\t      for (i = m = 0, len4 = ref3.length; m < len4; i = ++m) {\n\t        page = ref3[i];\n\t        data.set(page, offset);\n\t        if (i === frame.data.length - 1) {\n\t          offset += frame.cursor;\n\t        } else {\n\t          offset += frame.pageSize;\n\t        }\n\t      }\n\t    }\n\t    image = new Blob([data], {\n\t      type: 'image/gif'\n\t    });\n\t    return this.emit('finished', image, data);\n\t  };\n\t\n\t  GIF.prototype.renderNextFrame = function() {\n\t    var frame, index, previousFrame, task, worker;\n\t    if (this.freeWorkers.length === 0) {\n\t      throw new Error('No free workers');\n\t    }\n\t    if (this.nextFrame >= this.frames.length || this.nextFrame >= this.imageParts.length) {\n\t      return;\n\t    }\n\t    index = this.nextFrame++;\n\t    frame = this.frames[index];\n\t    previousFrame = null;\n\t    if (this.previousFrames.has(index - 1)) {\n\t      previousFrame = this.previousFrames.get(index - 1);\n\t    }\n\t    if (index > 0 && this.groups.has(frame.data) && this.groups.get(frame.data)[0] !== index) {\n\t      setTimeout((function(_this) {\n\t        return function() {\n\t          return _this.frameFinished(frame, true);\n\t        };\n\t      })(this), 0);\n\t      return;\n\t    }\n\t    worker = this.freeWorkers.shift();\n\t    task = this.getTask(frame, previousFrame);\n\t    this.log(\"starting frame \" + (task.index + 1) + \" of \" + this.frames.length);\n\t    this.activeWorkers.push(worker);\n\t    worker.postMessage(task);\n\t    this.frames[index] = null;\n\t    return this.previousFrames[index - 1] = null;\n\t  };\n\t\n\t  GIF.prototype.getContextData = function(ctx) {\n\t    return ctx.getImageData(0, 0, this.options.width, this.options.height).data;\n\t  };\n\t\n\t  GIF.prototype.getImageData = function(image) {\n\t    var ctx;\n\t    if (this._canvas == null) {\n\t      this._canvas = document.createElement('canvas');\n\t      this._canvas.width = this.options.width;\n\t      this._canvas.height = this.options.height;\n\t    }\n\t    ctx = this._canvas.getContext('2d');\n\t    ctx.setFill = this.options.background;\n\t    ctx.fillRect(0, 0, this.options.width, this.options.height);\n\t    ctx.drawImage(image, 0, 0);\n\t    return this.getContextData(ctx);\n\t  };\n\t\n\t  GIF.prototype.getFrameDataForTask = function(frame) {\n\t    if (frame.data != null) {\n\t      return frame.data;\n\t    } else if (frame.context != null) {\n\t      return this.getContextData(frame.context);\n\t    } else if (frame.image != null) {\n\t      return this.getImageData(frame.image);\n\t    } else {\n\t      throw new Error('Invalid frame');\n\t    }\n\t  };\n\t\n\t  GIF.prototype.getTask = function(frame, previousFrame) {\n\t    var index, task;\n\t    index = this.frames.indexOf(frame);\n\t    task = {\n\t      index: index,\n\t      last: index === (this.frames.length - 1),\n\t      delay: frame.delay,\n\t      transparent: frame.transparent,\n\t      width: this.options.width,\n\t      height: this.options.height,\n\t      quality: this.options.quality,\n\t      dither: this.options.dither,\n\t      globalPalette: this.options.globalPalette,\n\t      repeat: this.options.repeat,\n\t      canTransfer: true,\n\t      data: this.getFrameDataForTask(frame),\n\t      applyCropOptimization: this.options.applyCropOptimization,\n\t      transparencyDifferenceThreshold: this.options.transparencyDifferenceThreshold,\n\t      dispose: this.options.dispose,\n\t      applyTransparencyOptimization: this.options.applyTransparencyOptimization\n\t    };\n\t    if (previousFrame != null) {\n\t      task.previousFrameData = this.getFrameDataForTask(previousFrame);\n\t    }\n\t    return task;\n\t  };\n\t\n\t  GIF.prototype.log = function(msg) {\n\t    if (this.options.debug) {\n\t      return console.log(msg);\n\t    }\n\t  };\n\t\n\t  return GIF;\n\t\n\t})(EventEmitter);\n\t\n\tmodule.exports = GIF;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\t// Copyright Joyent, Inc. and other Node contributors.\n\t//\n\t// Permission is hereby granted, free of charge, to any person obtaining a\n\t// copy of this software and associated documentation files (the\n\t// \"Software\"), to deal in the Software without restriction, including\n\t// without limitation the rights to use, copy, modify, merge, publish,\n\t// distribute, sublicense, and/or sell copies of the Software, and to permit\n\t// persons to whom the Software is furnished to do so, subject to the\n\t// following conditions:\n\t//\n\t// The above copyright notice and this permission notice shall be included\n\t// in all copies or substantial portions of the Software.\n\t//\n\t// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\t// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n\t// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n\t// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n\t// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n\t// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n\t// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\t\n\tfunction EventEmitter() {\n\t  this._events = this._events || {};\n\t  this._maxListeners = this._maxListeners || undefined;\n\t}\n\tmodule.exports = EventEmitter;\n\t\n\t// Backwards-compat with node 0.10.x\n\tEventEmitter.EventEmitter = EventEmitter;\n\t\n\tEventEmitter.prototype._events = undefined;\n\tEventEmitter.prototype._maxListeners = undefined;\n\t\n\t// By default EventEmitters will print a warning if more than 10 listeners are\n\t// added to it. This is a useful default which helps finding memory leaks.\n\tEventEmitter.defaultMaxListeners = 10;\n\t\n\t// Obviously not all Emitters should be limited to 10. This function allows\n\t// that to be increased. Set to zero for unlimited.\n\tEventEmitter.prototype.setMaxListeners = function(n) {\n\t  if (!isNumber(n) || n < 0 || isNaN(n))\n\t    throw TypeError('n must be a positive number');\n\t  this._maxListeners = n;\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.emit = function(type) {\n\t  var er, handler, len, args, i, listeners;\n\t\n\t  if (!this._events)\n\t    this._events = {};\n\t\n\t  // If there is no 'error' event listener then throw.\n\t  if (type === 'error') {\n\t    if (!this._events.error ||\n\t        (isObject(this._events.error) && !this._events.error.length)) {\n\t      er = arguments[1];\n\t      if (er instanceof Error) {\n\t        throw er; // Unhandled 'error' event\n\t      } else {\n\t        // At least give some kind of context to the user\n\t        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n\t        err.context = er;\n\t        throw err;\n\t      }\n\t    }\n\t  }\n\t\n\t  handler = this._events[type];\n\t\n\t  if (isUndefined(handler))\n\t    return false;\n\t\n\t  if (isFunction(handler)) {\n\t    switch (arguments.length) {\n\t      // fast cases\n\t      case 1:\n\t        handler.call(this);\n\t        break;\n\t      case 2:\n\t        handler.call(this, arguments[1]);\n\t        break;\n\t      case 3:\n\t        handler.call(this, arguments[1], arguments[2]);\n\t        break;\n\t      // slower\n\t      default:\n\t        args = Array.prototype.slice.call(arguments, 1);\n\t        handler.apply(this, args);\n\t    }\n\t  } else if (isObject(handler)) {\n\t    args = Array.prototype.slice.call(arguments, 1);\n\t    listeners = handler.slice();\n\t    len = listeners.length;\n\t    for (i = 0; i < len; i++)\n\t      listeners[i].apply(this, args);\n\t  }\n\t\n\t  return true;\n\t};\n\t\n\tEventEmitter.prototype.addListener = function(type, listener) {\n\t  var m;\n\t\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  if (!this._events)\n\t    this._events = {};\n\t\n\t  // To avoid recursion in the case that type === \"newListener\"! Before\n\t  // adding it to the listeners, first emit \"newListener\".\n\t  if (this._events.newListener)\n\t    this.emit('newListener', type,\n\t              isFunction(listener.listener) ?\n\t              listener.listener : listener);\n\t\n\t  if (!this._events[type])\n\t    // Optimize the case of one listener. Don't need the extra array object.\n\t    this._events[type] = listener;\n\t  else if (isObject(this._events[type]))\n\t    // If we've already got an array, just append.\n\t    this._events[type].push(listener);\n\t  else\n\t    // Adding the second element, need to change to array.\n\t    this._events[type] = [this._events[type], listener];\n\t\n\t  // Check for listener leak\n\t  if (isObject(this._events[type]) && !this._events[type].warned) {\n\t    if (!isUndefined(this._maxListeners)) {\n\t      m = this._maxListeners;\n\t    } else {\n\t      m = EventEmitter.defaultMaxListeners;\n\t    }\n\t\n\t    if (m && m > 0 && this._events[type].length > m) {\n\t      this._events[type].warned = true;\n\t      console.error('(node) warning: possible EventEmitter memory ' +\n\t                    'leak detected. %d listeners added. ' +\n\t                    'Use emitter.setMaxListeners() to increase limit.',\n\t                    this._events[type].length);\n\t      if (typeof console.trace === 'function') {\n\t        // not supported in IE 10\n\t        console.trace();\n\t      }\n\t    }\n\t  }\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\t\n\tEventEmitter.prototype.once = function(type, listener) {\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  var fired = false;\n\t\n\t  function g() {\n\t    this.removeListener(type, g);\n\t\n\t    if (!fired) {\n\t      fired = true;\n\t      listener.apply(this, arguments);\n\t    }\n\t  }\n\t\n\t  g.listener = listener;\n\t  this.on(type, g);\n\t\n\t  return this;\n\t};\n\t\n\t// emits a 'removeListener' event iff the listener was removed\n\tEventEmitter.prototype.removeListener = function(type, listener) {\n\t  var list, position, length, i;\n\t\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  if (!this._events || !this._events[type])\n\t    return this;\n\t\n\t  list = this._events[type];\n\t  length = list.length;\n\t  position = -1;\n\t\n\t  if (list === listener ||\n\t      (isFunction(list.listener) && list.listener === listener)) {\n\t    delete this._events[type];\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\t\n\t  } else if (isObject(list)) {\n\t    for (i = length; i-- > 0;) {\n\t      if (list[i] === listener ||\n\t          (list[i].listener && list[i].listener === listener)) {\n\t        position = i;\n\t        break;\n\t      }\n\t    }\n\t\n\t    if (position < 0)\n\t      return this;\n\t\n\t    if (list.length === 1) {\n\t      list.length = 0;\n\t      delete this._events[type];\n\t    } else {\n\t      list.splice(position, 1);\n\t    }\n\t\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\t  }\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.removeAllListeners = function(type) {\n\t  var key, listeners;\n\t\n\t  if (!this._events)\n\t    return this;\n\t\n\t  // not listening for removeListener, no need to emit\n\t  if (!this._events.removeListener) {\n\t    if (arguments.length === 0)\n\t      this._events = {};\n\t    else if (this._events[type])\n\t      delete this._events[type];\n\t    return this;\n\t  }\n\t\n\t  // emit removeListener for all listeners on all events\n\t  if (arguments.length === 0) {\n\t    for (key in this._events) {\n\t      if (key === 'removeListener') continue;\n\t      this.removeAllListeners(key);\n\t    }\n\t    this.removeAllListeners('removeListener');\n\t    this._events = {};\n\t    return this;\n\t  }\n\t\n\t  listeners = this._events[type];\n\t\n\t  if (isFunction(listeners)) {\n\t    this.removeListener(type, listeners);\n\t  } else if (listeners) {\n\t    // LIFO order\n\t    while (listeners.length)\n\t      this.removeListener(type, listeners[listeners.length - 1]);\n\t  }\n\t  delete this._events[type];\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.listeners = function(type) {\n\t  var ret;\n\t  if (!this._events || !this._events[type])\n\t    ret = [];\n\t  else if (isFunction(this._events[type]))\n\t    ret = [this._events[type]];\n\t  else\n\t    ret = this._events[type].slice();\n\t  return ret;\n\t};\n\t\n\tEventEmitter.prototype.listenerCount = function(type) {\n\t  if (this._events) {\n\t    var evlistener = this._events[type];\n\t\n\t    if (isFunction(evlistener))\n\t      return 1;\n\t    else if (evlistener)\n\t      return evlistener.length;\n\t  }\n\t  return 0;\n\t};\n\t\n\tEventEmitter.listenerCount = function(emitter, type) {\n\t  return emitter.listenerCount(type);\n\t};\n\t\n\tfunction isFunction(arg) {\n\t  return typeof arg === 'function';\n\t}\n\t\n\tfunction isNumber(arg) {\n\t  return typeof arg === 'number';\n\t}\n\t\n\tfunction isObject(arg) {\n\t  return typeof arg === 'object' && arg !== null;\n\t}\n\t\n\tfunction isUndefined(arg) {\n\t  return arg === void 0;\n\t}\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\t\n\t/* CoffeeScript version of the browser detection from MooTools */\n\tvar UA, browser, mode, platform, ua;\n\t\n\tua = navigator.userAgent.toLowerCase();\n\t\n\tplatform = navigator.platform.toLowerCase();\n\t\n\tUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) || [null, 'unknown', 0];\n\t\n\tmode = UA[1] === 'ie' && document.documentMode;\n\t\n\tbrowser = {\n\t  name: UA[1] === 'version' ? UA[3] : UA[1],\n\t  version: mode || parseFloat(UA[1] === 'opera' && UA[4] ? UA[4] : UA[2]),\n\t  platform: {\n\t    name: ua.match(/ip(?:ad|od|hone)/) ? 'ios' : (ua.match(/(?:webos|android)/) || platform.match(/mac|win|linux/) || ['other'])[0]\n\t  }\n\t};\n\t\n\tbrowser[browser.name] = true;\n\t\n\tbrowser[browser.name + parseInt(browser.version, 10)] = true;\n\t\n\tbrowser.platform[browser.platform.name] = true;\n\t\n\tmodule.exports = browser;\n\n\n/***/ })\n/******/ ])\n});\n;\n\n\n// WEBPACK FOOTER //\n// gif.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1c35d463df0a05b881a0","{EventEmitter} = require 'events'\nbrowser = require './browser.coffee'\n\nclass GIF extends EventEmitter\n\n  defaults =\n    workerScript: 'gif.worker.js'\n    workers: 2\n    repeat: 0 # repeat forever, -1 = repeat once\n    background: '#fff'\n    quality: 10 # pixel sample interval, lower is better\n    width: null # size derermined from first frame if possible\n    height: null\n    transparent: null\n    debug: false\n\n  frameDefaults =\n    delay: 500 # ms\n    copy: false\n    applyCropOptimization: false\n    transparencyDifferenceThreshold: 1\n    applyTransparencyOptimization: false\n    dispose: -1\n\n  constructor: (options) ->\n    @running = false\n\n    @options = {}\n    @frames = []\n    @previousFrames = new Map()\n    @pendingFrameCount = 0\n\n    # TODO: compare by instance and not by data\n    @groups = new Map() # for [data1, data1, data2, data1] @groups[data1] == [1, 3] and @groups[data2] = [2]\n\n    @freeWorkers = []\n    @activeWorkers = []\n    @canFinish = false\n\n    @setOptions options\n    for key, value of defaults\n      @options[key] ?= value\n\n    @batchSizeForRendering = @options.workers\n    @curBatchSizeLastIndex = 0\n\n    # Spawn workers once and re-use them for all batches.\n    @spawnWorkers()\n    @taskQueue = []\n\n  setOption: (key, value) ->\n    @options[key] = value\n    if @_canvas? and key in ['width', 'height']\n      @_canvas[key] = value\n\n  setOptions: (options) ->\n    @setOption key, value for own key, value of options\n\n  getFrameData: (image, frame, options={}) ->\n    if ImageData? and image instanceof ImageData\n       frame.data = image.data\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\n      if options.copy\n        frame.data = @getContextData image\n      else\n        frame.context = image\n    else if image.childNodes?\n      if options.copy\n        frame.data = @getImageData image\n      else\n        frame.image = image\n    else\n      throw new Error 'Invalid image'\n    return frame\n\n  addFrame: (image, options={}) ->\n    @pendingFrameCount++\n    frame = {}\n    previousFrame = {}\n    frame.transparent = @options.transparent\n    for key of frameDefaults\n      frame[key] = options[key] or frameDefaults[key]\n\n    # use the images width and height for options unless already set\n    @setOption 'width', image.width unless @options.width?\n    @setOption 'height', image.height unless @options.height?\n\n    frame = @getFrameData image, frame, options\n    if @options.applyTransparencyOptimization and options.previousImage?\n      previousFrame = @getFrameData options.previousImage, previousFrame, options\n\n    # find duplicates in frames.data\n    index = @frames.length\n    if index > 0 and frame.data # frame 0 contains header, do not count it\n      if @groups.has(frame.data)\n        @groups.get(frame.data).push index\n      else\n        @groups.set frame.data, [index]\n\n    @frames.push frame\n    if previousFrame.data?\n      @previousFrames.set index, previousFrame\n\n    if @pendingFrameCount > @batchSizeForRendering\n      # If all workers are occupied, then flush tasks to free workers.\n      if @freeWorkers.length == 0 || @taskQueue.length > 0\n        @flushTasks().then ->\n          @addBatchForRendering()\n      else\n        @addBatchForRendering()\n    @emit 'progress', 1\n\n  render: ->\n    return if @pendingFrameCount == 0\n\n    throw new Error 'Already running' if @running\n\n    if not @options.width? or not @options.height?\n      throw new Error 'Width and height must be set prior to rendering'\n\n    @running = true\n    @nextFrame = 0\n    @finishedFrames = 0\n\n    for i in [0...Math.min @pendingFrameCount, @batchSizeForRendering]\n      @imageParts.push(null)\n\n    numWorkers = @freeWorkers.length\n    # we need to wait for the palette\n    if @options.globalPalette == true\n      @renderNextFrame()\n    else\n      @renderNextFrame() for i in [0...numWorkers]\n\n    @emit 'start'\n    @emit 'progress', 0\n\n  abort: ->\n    loop\n      worker = @activeWorkers.shift()\n      break unless worker?\n      @log \"killing active worker\"\n      worker.terminate()\n    @running = false\n    @emit 'abort'\n\n  # private\n\n  addBatchForRendering: ->\n    framesToRender = Math.min pendingFrameCount, @batchSizeForRendering\n    @curBatchSizeLastIndex = @curBatchSizeLastIndex + framesToRender\n    task = new Promise (resolve) ->\n      setTimeout ->\n        @render()\n        @taskQueue = []\n        @resolve()\n    @taskQueue.push(task)\n\n  flushTasks: ->\n    Promise.all(@taskQueue)\n      .then () ->\n        @taskQueue = []\n        @emit 'progress', 2\n      .catch (error) ->\n        throw error\n\n  spawnWorkers: ->\n    numWorkers = Math.min(@options.workers, @frames.length)\n    [@freeWorkers.length...numWorkers].forEach (i) =>\n      @log \"spawning worker #{ i }\"\n      worker = new Worker @options.workerScript\n      worker.onmessage = (event) =>\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\n        @freeWorkers.push worker\n        @frameFinished event.data, false\n      @freeWorkers.push worker\n    return numWorkers\n\n  frameFinished: (frame, duplicate) ->\n    @finishedFrames++\n    @pendingFrameCount--\n    if not duplicate\n      @log \"frame #{ frame.index + 1 } finished - #{ @activeWorkers.length } active\"\n      @emit 'progress', 1\n      @imageParts[frame.index] = frame\n    else\n      indexOfDuplicate = @frames.indexOf frame\n      indexOfFirstInGroup = @groups.get(frame.data)[0]\n      @log \"frame #{ indexOfDuplicate + 1 } is duplicate of #{ indexOfFirstInGroup } - #{ @activeWorkers.length } active\"\n      @imageParts[indexOfDuplicate] = { indexOfFirstInGroup: indexOfFirstInGroup } # do not put frame here, as it may not be available still. Put index.\n    # remember calculated palette, spawn the rest of the workers\n    if @options.globalPalette == true and not duplicate\n      @options.globalPalette = frame.globalPalette\n      @log \"global palette analyzed\"\n      @renderNextFrame() for i in [1...@freeWorkers.length] if @frames.length > 2\n    if null in @imageParts\n      @renderNextFrame()\n    else if @canFinish\n      @finishRendering()\n\n  flush: ->\n    @flushTasks().then ->\n      @canFinish = true\n      @addBatchForRendering()\n\n  finishRendering: ->\n    for frame, index in @imageParts\n      @imageParts[index] = @imageParts[frame.indexOfFirstInGroup] if frame.indexOfFirstInGroup\n    len = 0\n    for frame in @imageParts\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n    len += frame.pageSize - frame.cursor\n    @log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\n    data = new Uint8Array len\n    offset = 0\n    for frame in @imageParts\n      for page, i in frame.data\n        data.set page, offset\n        if i is frame.data.length - 1\n          offset += frame.cursor\n        else\n          offset += frame.pageSize\n\n    image = new Blob [data],\n      type: 'image/gif'\n\n    @emit 'finished', image, data\n\n  renderNextFrame: ->\n    throw new Error 'No free workers' if @freeWorkers.length is 0\n    return if @nextFrame >= @frames.length || @nextFrame >= @imageParts.length # no new frame to render\n\n    index = @nextFrame++\n    frame = @frames[index]\n\n    # check if one of duplicates, but not the first in group\n    previousFrame = null\n    if @previousFrames.has(index - 1)\n      previousFrame = @previousFrames.get(index - 1)\n\n    if index > 0 and @groups.has(frame.data) and @groups.get(frame.data)[0] != index\n      setTimeout =>\n        @frameFinished frame, true\n      , 0\n      return\n\n    worker = @freeWorkers.shift()\n    task = @getTask frame, previousFrame\n\n    @log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\n    @activeWorkers.push worker\n    worker.postMessage task#, [task.data.buffer]\n    # Dispose unused memory.\n    @frames[index] = null\n    @previousFrames[index - 1] = null\n\n  getContextData: (ctx) ->\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\n\n  getImageData: (image) ->\n    if not @_canvas?\n      @_canvas = document.createElement 'canvas'\n      @_canvas.width = @options.width\n      @_canvas.height = @options.height\n\n    ctx = @_canvas.getContext '2d'\n    ctx.setFill = @options.background\n    ctx.fillRect 0, 0, @options.width, @options.height\n    ctx.drawImage image, 0, 0\n\n    return @getContextData ctx\n\n  getFrameDataForTask: (frame) ->\n    if frame.data?\n      return frame.data\n    else if frame.context?\n      return @getContextData frame.context\n    else if frame.image?\n      return @getImageData frame.image\n    else\n      throw new Error 'Invalid frame'\n\n  getTask: (frame, previousFrame) ->\n    index = @frames.indexOf frame\n    task =\n      index: index\n      last: index is (@frames.length - 1)\n      delay: frame.delay\n      transparent: frame.transparent\n      width: @options.width\n      height: @options.height\n      quality: @options.quality\n      dither: @options.dither\n      globalPalette: @options.globalPalette\n      repeat: @options.repeat\n      canTransfer: true\n      data: @getFrameDataForTask frame\n      applyCropOptimization: @options.applyCropOptimization\n      transparencyDifferenceThreshold: @options.transparencyDifferenceThreshold\n      dispose: @options.dispose\n      applyTransparencyOptimization: @options.applyTransparencyOptimization\n\n    if previousFrame?\n      task.previousFrameData = @getFrameDataForTask previousFrame\n\n    return task\n\n  log: (msg) ->\n    console.log msg if @options.debug\n\nmodule.exports = GIF\n\n\n// WEBPACK FOOTER //\n// ./src/gif.coffee","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 1\n// module chunks = 0","### CoffeeScript version of the browser detection from MooTools ###\n\nua = navigator.userAgent.toLowerCase()\nplatform = navigator.platform.toLowerCase()\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\nmode = UA[1] == 'ie' && document.documentMode\n\nbrowser =\n  name: if UA[1] is 'version' then UA[3] else UA[1]\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\n\n  platform:\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\n\nbrowser[browser.name] = true\nbrowser[browser.name + parseInt(browser.version, 10)] = true\nbrowser.platform[browser.platform.name] = true\n\nmodule.exports = browser\n\n\n\n// WEBPACK FOOTER //\n// ./src/browser.coffee"],"sourceRoot":""}